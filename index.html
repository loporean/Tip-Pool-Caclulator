<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Tip Pooling Calculator</title>
    <script type="text/javascript">

        // Container to hold results
        var results = [];

        // Tips per hour
        var tipShare = 0;

        // Total hours
        var totalRoundedHours = 0;

        // Total tips
        var totTips = 0;

        // initialize to 2 since 1 is already present
        let count = 2;

        // Adds another employee field for calculating
        function addEmployee() {
            console.log("Add employee " + count);

            // Container where new field will be added
            var container = document.getElementById("employeeContainer");

            var employeeCount = document.createElement("span");
            employeeCount.textContent = count + ". ";

            // Create new input field for name and hours
            var nameField = document.createElement("input");
            nameField.type = "text";
            nameField.name = "name";
            nameField.placeholder = "Employee Name";

            var hoursField = document.createElement("input");
            hoursField.type = "text";
            hoursField.name = "hours";
            hoursField.placeholder = "Hours Worked";
            hoursField.min = "0";
            hoursField.oninput = function() { isNum(this); };

            // Add line break
            var br = document.createElement("br");

            // Append new fields to container
            container.appendChild(employeeCount);
            container.appendChild(nameField);
            container.appendChild(hoursField);
            container.appendChild(br);

            // incrememnt employee count
            count++;
        }

        // Remove employee field
        function removeEmployee() {
            var container = document.getElementById("employeeContainer");
            var elements = container.children;
            
            // Remove the last employee field
            // 4 because there are 4 fields to remove per line
            if (elements.length > 4) {
                for (let i=0; i<4; i++) {
                    container.removeChild(container.lastChild);
                }
                count--;
            }
        }

        function calcTips() {
            // Clear results
            results.innerHTML = "";
            // Grab all input fields with name "hours"
            var hoursField = document.getElementsByName("hours");
            totalRoundedHours = 0;

            for (var i=0; i<hoursField.length; i++) {
                var value = parseFloat(hoursField[i].value);

                if (!isNaN(value)) {
                    var roundedValue = Math.round(value);
                    hoursField[i].value = roundedValue;
                    totalRoundedHours += roundedValue;
                }
            }

            console.log("total rounded hours: ", totalRoundedHours);

            tipsPerHour();

            shareOfTips();

        }

        // Calculate the tip share
        function tipsPerHour() {
            totTips = document.getElementById("totalTips").value;
            console.log("tot tips: ", totTips);
            tipShare = totTips / totalRoundedHours;
            console.log("Share of tips per hour: ", tipShare);
        }

        // Calculate each employees tip share
        function shareOfTips() {
            // Grab the list of employees and rounded hours each employee worked
            var employees = document.getElementsByName("name");
            var hours = document.getElementsByName("hours");

            // Container for displaying results
            results = document.getElementById("results");
            // Title
            var title = document.createElement("h2");
            title.textContent = "Tip Share";
            // Unordered list of results
            var list = document.createElement("ul");

            // Loop through each employee and generate their tips
            for (var i=0; i<hours.length; i++) {
                var nameValue = employees[i].value;
                var hoursValue = parseFloat(hours[i].value);
                var tips = 0;

                if (!isNaN(hoursValue)) {
                    tips = parseFloat(hoursValue * tipShare).toFixed(2);

                    // Create a list of employees, their hours and the tip share
                    // var listItem = document.createElement("li");
                    var listItem = document.createElement("li");
                    listItem.style.padding = "3px";
                    listItem.textContent = nameValue + ": $" + tips;
                    
                    console.log("Name: " + nameValue, "Hours: " + hoursValue, "Tip Share: " + tips);

                    // Add list item
                    list.appendChild(listItem);
                    
                }
            }
            // Add list to div
            results.appendChild(title);
            results.appendChild(list);
        }

        // Clear the input fields after a page refresh
        function resetFormFields() {
            var inputFields = document.getElementsByTagName("input");
            for (var i=0; i<inputFields.length; i++) {
                if (inputFields[i].type !== "button" && inputFields[i].type !== "submit") {
                    inputFields[i].value = "";
                }
            }
            // Reset tip share
            tipShare = 0;
            // Reset total tips
            totTips = 0;
            // Clear results
            results.innerHTML = "";
        }

        // Check if the user input is a number
        function isNum(input) {
            // Accept only whole numbers and decimal numbers
            input.value = input.value.replace(/[^0-9.]/g, '');
        }

        window.onload = resetFormFields;

    </script>
</head>
<body>
    <h1>Tip Pooling Calculator</h1>

    <!-- Description of calculator -->
     <div class="description">
         <p>The Tip Pooling Calculator divides tips among employees 
            based on their hours worked, guaranteeing equitable distribution 
            from the shared tips pool.</p>
     </div>
            
    <button type="button" onclick="addEmployee()">add</button>
    <button type="button" onclick="removeEmployee()">remove</button><br><br>
    
    <!-- Title for inputs -->
        <div class="inputTitle">
        <span>Name</span>
        <span>Hours</span>
        </div>
    
    <div id="employeeContainer" class="employeeContainer">
        <span>1. </span>
            <input type="text" id="name" name="name" placeholder="Employee Name"><input type="text" id="hours" name="hours" placeholder="Hours Worked" min="0" oninput="isNum(this)">
        <br>
    </div> 
    <br>

    <!-- Reset Button for inputs -->
    <button type="button" onclick="resetFormFields()">Reset</button>

    <br><br>

    <label for="totalTips" style="font-weight: 100;">Total Tips:</label>
    <input type="text" id="totalTips" name="totalTips" oninput="isNum(this)">
    <br><br><br>

    <button type="button" onclick="calcTips()">Calculate Tips</button>


    <!--  Displays results after calculating tips -->
    <div id="results" class="results"></div>

</body>
</html>